<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFD600" />
  <title>Fritsky Fidelidad</title>

  <script>
    // Detecta si est√°s en GitHub Pages o en local y define la base para las rutas
    const isGitHub = window.location.hostname === 'tocosan.github.io'; // Cambia si tu dominio es otro
    window.BASE_PATH = isGitHub ? '/fritsky-pwa/' : '/';
  </script>

  <!-- Carga din√°mica del CSS -->
  <script>
    const linkCss = document.createElement('link');
    linkCss.rel = 'stylesheet';
    linkCss.href = window.BASE_PATH + 'style.css';
    document.head.appendChild(linkCss);
  </script>

  <!-- Carga din√°mica del manifest -->
  <script>
    const linkManifest = document.createElement('link');
    linkManifest.rel = 'manifest';
    linkManifest.href = window.BASE_PATH + 'manifest.json';
    document.head.appendChild(linkManifest);
  </script>

  <!-- Favicon y Meta tags PWA -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Fritsky" />
  <link rel="apple-touch-icon" href="" id="appleIcon" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" id="faviconIcon" />

  <!-- Font Awesome para √≠conos -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  />
</head>
<body>
  <header>
    <img src="images/logo.png" alt="Logo Fritsky Patateria" id="logo-header" />
    <h1>Fritsky Patateria</h1>
    <div id="user-status-container">
      <span id="userInfo"></span>
      <button id="btnLogout" class="button-secondary" style="display:none;">
        Cerrar Sesi√≥n
      </button>
    </div>
  </header>

  <nav>
    <button data-target="pagina-promociones" class="nav-button">Promociones</button>
    <button id="btnMisPuntosNav" data-target="pagina-puntos" class="nav-button">
      Mis Puntos
    </button>
    <button data-target="pagina-menu" class="nav-button">Nuestra Carta</button>
    <button data-target="pagina-mi-qr" class="nav-button">Mi QR</button>
    <button id="btnGoToAuth" data-target="pagina-auth" class="nav-button">
      Acceder/Registro
    </button>
  </nav>

  <main>
    <div id="mensajes-container" class="mensajes-container"></div>

    <!-- P√ÅGINA DE PROMOCIONES -->
    <div id="pagina-promociones" class="pagina">
      <section id="promociones">
        <h2>Promociones Especiales</h2>
        <div class="card1">
          <h3>üçü Jueves de 2x1 Cono Chico üçü</h3>
          <p>¬°Llevate 2 conos peque√±os al precio de uno!.</p>
        </div>
        <div class="card1">
          <h3>üéâ Combo Cumplea√±ero üéâ</h3>
          <p>
            ¬°Es tu cumplea√±os? Presenta tu app y recibe unas Fritsky peque√±as de
            regalo!.
          </p>
        </div>
      </section>
    </div>

    <!-- P√ÅGINA DE PUNTOS Y PREMIOS -->
    <div id="pagina-puntos" class="pagina">
      <section id="puntos-cliente">
        <h2>Tu Club Fritsky</h2>
        <div class="card puntos-card-container">
          <p class="puntos-label">Puntos Disponibles</p>
          <p id="contador-puntos" class="puntos-valor">0</p>

          <div class="acumulacion-info">
            <h3 class="acumulacion-titulo">¬øC√≥mo gano puntos?</h3>
            <ul class="acumulacion-lista">
              <li>üí∂ Hasta <strong>4‚Ç¨</strong> : 1 punto</li>
              <li>üí∂ Hasta <strong>7‚Ç¨</strong> : 2 puntos</li>
              <li>üí∂ M√°s de <strong>10‚Ç¨</strong> : 3 puntos</li>
            </ul>
          </div>

          <h3 class="premio-titulo">üéÅ Canjea tus puntos!! üéÅ</h3>

          <div class="premio-info">
            <p class="premio-descripcion">
              ¬°Acumula <strong>5 puntos</strong> y obt√©n una Raci√≥n de Salsa Especial
              Gratis!
              <i class="fas fa-pepper-hot fa-2x"></i>
            </p>
          </div>
          <div class="premio-info">
            <p class="premio-descripcion">
              ¬°Acumula <strong>10 puntos</strong> y ll√©vate un Cono Chico + Refresco
              Lata Gratis!
              <i class="fas fa-pepper-hot fa-2x"></i>
            </p>
          </div>
          <div class="premio-info">
            <p class="premio-descripcion">
              ¬°Acumula <strong>15 puntos</strong> y Llevate un Cono Medio con Toppings +
              Lata Refresco Gratis!
              <i class="fas fa-pepper-hot fa-2x"></i>
            </p>
          </div>
          <div class="premio-info">
            <p class="premio-descripcion">
              ¬°Acumula <strong>18 puntos</strong> y recibe una Big Box de 10 unidades
              Gratis!
              <i class="fas fa-box-open fa-2x"></i>
            </p>
          </div>

          <div class="boton-ruleta-container" style="text-align: center; margin-top: 20px;">
            <button id="btn-jugar-ruleta" class="boton-ruleta">üé∞ Jugar a la Ruleta</button>
          </div>

          <div id="ruleta-container" class="ruleta-container" style="display: none;"></div>
          <div id="mensaje-ruleta-no-disponible" class="mensaje-ya-jugado" style="display: none;"></div>

          <div class="ranking-container">
            <h3>Ranking de Clientes Fritsky üèÜ</h3>
            <ul>
              <!-- Aqu√≠ se insertar√°n din√°micamente los <li> con el ranking -->
            </ul>
          </div>
        </div>
      </section>
    </div>

    <!-- P√ÅGINA DEL MEN√ö/CARTA -->
    <div id="pagina-menu" class="pagina">
      <section id="carta">
        <h2>Men√∫ Fritsky</h2>
        <div id="menu-container">
          <p>Cargando men√∫...</p>
        </div>
      </section>
    </div>

    <!-- P√ÅGINA DE AUTENTICACI√ìN -->
    <div id="pagina-auth" class="pagina">
      <section id="auth-section">
        <h2>Acceso / Registro de Clientes Fritsky</h2>

        <div class="auth-form-container card auth-form-login">
          <h3><i class="fas fa-sign-in-alt auth-icon"></i> Iniciar Sesi√≥n</h3>
          <form id="loginForm">
            <div class="form-group">
              <label for="loginEmail">Correo Electr√≥nico</label>
              <div class="input-group">
                <span class="input-group-addon"><i class="fas fa-envelope"></i></span>
                <input type="email" id="loginEmail" required placeholder="tuemail@ejemplo.com" />
              </div>
            </div>
            <div class="form-group">
              <label for="loginPassword">Contrase√±a</label>
              <div class="input-group">
                <span class="input-group-addon"><i class="fas fa-lock"></i></span>
                <input type="password" id="loginPassword" required placeholder="********" />
              </div>
            </div>
            <a href="#" id="forgotPasswordLink" class="forgot-password-link"
              >¬øOlvidaste tu contrase√±a?</a
            >
            <button type="submit" class="button-primary">Iniciar Sesi√≥n</button>
          </form>
          <p id="loginError" class="error-message"></p>

          <div class="auth-switch-prompt">
            <p>¬øNo tienes cuenta?</p>
            <button id="goToRegisterLink" class="button-secondary">Reg√≠strate Aqu√≠</button>
          </div>
        </div>

        <div
          id="registerFormContainer"
          class="auth-form-container card auth-form-register"
          style="display: none"
        >
          <h3><i class="fas fa-user-plus auth-icon"></i> √önete a Fritsky</h3>
          <form id="registerForm">
            <div class="form-group">
              <label for="registerEmail">Correo Electr√≥nico</label>
              <div class="input-group">
                <span class="input-group-addon"><i class="fas fa-envelope"></i></span>
                <input
                  type="email"
                  id="registerEmail"
                  required
                  placeholder="tuemail@ejemplo.com"
                />
              </div>
            </div>
            <div class="form-group">
              <label for="registerName">Nombre</label>
              <div class="input-group">
                <span class="input-group-addon"><i class="fas fa-user"></i></span>
                <input
                  type="text"
                  id="registerName"
                  required
                  placeholder="Tu nombre"
                />
              </div>
            </div>
            <div class="form-group">
              <label for="registerPassword">Contrase√±a</label>
              <div class="input-group">
                <span class="input-group-addon"><i class="fas fa-lock"></i></span>
                <input
                  type="password"
                  id="registerPassword"
                  required
                  minlength="6"
                  placeholder="M√≠nimo 6 caracteres"
                />
              </div>
            </div>
            <div class="form-group">
              <label for="registerBirthday">Fecha de Nacimiento</label>
              <div class="input-group">
                <span class="input-group-addon"><i class="fas fa-calendar-alt"></i></span>
                <input type="date" id="registerBirthday" required />
              </div>
            </div>
            <button type="submit" class="button-primary">Registrarme</button>
          </form>
          <p id="registerError" class="error-message"></p>
          <p id="registerSuccessMessage" class="success-message"></p>
          <div class="auth-switch-prompt">
            <p>¬øYa tienes cuenta?</p>
            <button id="goToLoginLink" class="button-secondary">Inicia Sesi√≥n</button>
          </div>
        </div>
      </section>
    </div>

    <!-- MODAL DE RECUPERACI√ìN DE CONTRASE√ëA -->
    <div id="passwordResetModal" class="modal" style="display: none">
      <div class="modal-content card">
        <span class="close-button">√ó</span>
        <h3><i class="fas fa-key auth-icon"></i>Recuperar Contrase√±a</h3>
        <p>
          Introduce tu correo electr√≥nico y te enviaremos un enlace para
          restablecer tu contrase√±a.
        </p>
        <form id="passwordResetForm">
          <div class="form-group">
            <label for="resetEmail">Correo Electr√≥nico</label>
            <div class="input-group">
              <span class="input-group-addon"><i class="fas fa-envelope"></i></span>
              <input
                type="email"
                id="resetEmail"
                required
                placeholder="tuemail@ejemplo.com"
              />
            </div>
          </div>
          <button type="submit" class="button-primary">Enviar Instrucciones</button>
        </form>
        <p id="passwordResetError" class="error-message"></p>
        <p id="passwordResetSuccess" class="success-message"></p>
      </div>
    </div>

    <!-- P√ÅGINA PARA MOSTRAR EL QR DEL CLIENTE -->
    <div id="pagina-mi-qr" class="pagina">
      <section id="mi-qr-section">
        <h2>Tu C√≥digo QR Fritsky</h2>
        <div class="qr-card">
          <div
            id="qrcode-container"
            style="width:200px; height:200px; margin: 20px auto"
          >
            <!-- Aqu√≠ se generar√° el QR Code -->
          </div>
          <p id="qrMessage"></p>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <div class="footer-social">
      <a
        href="https://www.instagram.com/fritsky.patateria"
        target="_blank"
        aria-label="Instagram"
        ><img alt="Instagram" id="instagramIcon"
      /></a>
      <a
        href="https://www.facebook.com/Fritsky.Patateria"
        target="_blank"
        aria-label="Facebook"
        ><img alt="Facebook" id="facebookIcon"
      /></a>
      <a
        href="https://www.tiktok.com/@fritsky.patateria"
        target="_blank"
        aria-label="TikTok"
        ><img alt="TikTok" id="tiktokIcon"
      /></a>
      <a
        href="https://g.page/r/CX95p7m3K_GDEBM/review"
        target="_blank"
        aria-label="Google Rese√±a"
        ><img alt="Google Rese√±a" id="googleIcon"
      /></a>
      <a href="https://fritsky.es" target="_blank" aria-label="Sitio Web"
        ><img alt="Sitio Web Fritsky" id="webIcon"
      /></a>
    </div>
    <p>¬© <span id="currentYear"></span> Fritsky Patateria - App de Fidelidad</p>
  </footer>

  <script>
    // Carga din√°mica de im√°genes con BASE_PATH
    const imagesMap = {
      logoHeader: 'images/logo.png',
      appleIcon: 'images/icon-192x192.png',
      faviconIcon: 'favicon.ico',
      instagramIcon: 'images/icons/social/instagram.png',
      facebookIcon: 'images/icons/social/facebook.png',
      tiktokIcon: 'images/icons/social/tiktok.png',
      googleIcon: 'images/icons/social/google.png',
      webIcon: 'images/icons/social/web.png',
    };

    for (const [id, path] of Object.entries(imagesMap)) {
      const el = document.getElementById(id);
      if (el) {
        el.src = window.BASE_PATH + path;
      }
    }

    // Mostrar a√±o actual
    document.getElementById('currentYear').textContent = new Date().getFullYear();
  </script>

  <!-- Carga de app.js -->
  <script type="module" src="app.js"></script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const registration = await navigator.serviceWorker.register(
            window.BASE_PATH + 'main-sw.js'
          );
          console.log('ServiceWorker registrado con √©xito:', registration.scope);

          if (window.firebaseMessaging) {
            window.firebaseMessaging.useServiceWorker(registration);
            console.log('Firebase Messaging vinculado al Service Worker.');
          }
        } catch (error) {
          console.error('Fallo al registrar el Service Worker:', error);
        }
      });
    }
  </script>
</body>
</html>
